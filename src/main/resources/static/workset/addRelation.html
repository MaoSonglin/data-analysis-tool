<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
		<link rel="stylesheet" type="text/css" href="../static/plugins/bootstrap/css/bootstrap.min.css"/>
		<link rel="stylesheet" type="text/css" href="../static/plugins/bootstrap/css/bootstrap-theme.min.css"/>
		<style type="text/css">
			#setRelation{
				margin: 20px 10px;
				box-sizing: border-box;
			}
			#setRelation .control-label{
				text-align: left;
			}
		</style>
	</head>
	<body>
		<div id="setRelation" class="col-md-6 col-md-offset-3">
			<form class="" action="#" method="">
				<div class="form-group">
					<label class="control-label">数据包</label>
					<input class="form-control" type="text" readonly="readonly" v-model="pkg.name" />
				</div>
				<div class="form-group">
					<label class="control-label" >数据表</label>
					<select class="form-control" name=""  v-model="table">
						<option value="">请选择数据表</option>
						<option value="" v-for="table in tables" :value="table.id"
						 v-html="table.chinese?table.chinese:table.name"></option>
					</select>
				</div>
				<div class="form-group">
					<label class="control-label">字段</label>
					<select class="form-control" name=""  @change="select($event)">
						<option value ="">请选择字段</option>
						<option v-for="field in fields" :value ="field.id"
						 v-html="field.chinese?field.chinese:field.name"></option>
					</select>
				</div>
			</form>
		</div>
		<script src="../res/js/vue.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../res/js/vue-resource.js" type="text/javascript" charset="utf-8"></script>
		<script src="../static/plugins/jquery/jquery.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../res/js/my-global.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			// document.write(localStorage.pkgid)
			new Vue({
				el:"#setRelation",
				data:{
					pkg : {},
					tables : [],
					fields : [],
					table : "",
					field : {}
				},
				created:function(){
					this.pkg = JSON.parse(localStorage.pkg)
					this.$http.get(basePath+"pkg/tab/"+this.pkg.id).then(function(res){
						this.tables = res.body.data
					})
				},
				methods:{
					setTable : function(id){
						this.$http.get(basePath+"vc/vt/"+id).then(function(res){
							this.$set(this,"fields",res.body.data);
						})
					},
					select : function(event){
						// alert(event.target.value)
						localStorage.relationId=event.target.value
						event.stopPropagation()
						this.$http.get(basePath+"vc/"+event.target.value).then(function(res){
							localStorage.relation = JSON.stringify(res.body.data)
						})
					},
				},
				watch:{
					"table" : function(newVal,oldVal){
						this.$http.get(basePath+"vt/vc/"+newVal).then(function(res){
							this.$set(this,"fields",res.body.data);
						})
					},
				}
			})
		</script>
	</body>
</html>
