<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>展示页面</title>
		<link rel="stylesheet" type="text/css" href="../static/plugins/layui/css/layui.css"/>
		<link rel="stylesheet" type="text/css" href="../static/plugins/bootstrap/css/bootstrap.min.css"/>
		<link rel="stylesheet" type="text/css" href="../static/plugins/bootstrap/css/bootstrap-theme.min.css"/>
		<style type="text/css">
			#wrapper{
				position: absolute;
				top: 0;
				right: 0;
				bottom: 0;
				left: 0;
			}
		</style>
	</head>
	<body>
		<div id="wrapper">
			<template v-for="(graph,index) in graphs">
				<div class="" v-bind:style="getPosition(graph)" v-bind:id="'graph-'+index">
					
				</div>
			</template>
		</div>
	</body>
	<script src="../res/js/my-global.js" type="text/javascript" charset="utf-8"></script>
	<script src="../static/plugins/jquery/jquery.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="../res/js/echarts.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="../res/js/vue.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="../res/js/vue-resource.js" type="text/javascript" charset="utf-8"></script>
	<script src="../static/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="../static/plugins/layui/layui.all.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
		var reportid = getParameter("id")
		var vue = new Vue({
			el:"#wrapper",
			data:{
				report:{},
				graphs : []
			},
			created : function (){
				// 获取报表信息
				this.$http.get(basePath+"report?id="+reportid).then(function(res){
					if(res.body.code == 0){
						layer.msg(res.body.message)
					}else{
						this.report = res.body.data
					}
				},function(error){
					layer.msg("网络错误")
				})
				// 获取报表中的图表信息
				this.$http.get(basePath+"report/graphs/"+reportid).then(function(res){
					if(res.body.code == 1)
						this.$set(this,'graphs',res.body.data)
					else{
						layer.msg(res.body.message)
					}
				},function(error){
					layer.msg("网络错误，获取图表信息失败")
				})
			},
			methods : {
				getPosition : function(graph){
					var dom = document.querySelector("#wrapper")
					var prob_x = dom.offsetWidth / this.report.width;
					var prob_y = dom.offsetHeight / this.report.height;
					var top = prob_x * graph.top
					var left = prob_y * graph.left
					var width = prob_x * graph.width
					var height = prob_y * graph.height
					var style = "border:1px solid red;position:absolute;top:"+top+"px;left:"+left+"px;width:"+width+"px;height:"+height+"px";
					console.log(style)
					return style
				}
			},
			updated:function(){
				for(let i in this.graphs){
					let dom = document.querySelector("#graph-"+i)
					let echart = echarts.init(dom)
					echart.setOption(JSON.parse(this.graphs[i].options))
					$.ajax({
						url : basePath+"graph/data/"+this.graphs[i].id,
						beforeSend : function(){
							echart.showLoading()
						},
						complete : function(){
							echart.hideLoading()
						},
						success : function(res){
							echart.setOption({
								dataset : {
									source : res.data
								}
							})
						}
					})
				}
			}
		})
		function load(){
			alert(234)
		}
	</script>
</html>
